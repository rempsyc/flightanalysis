<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Refactoring Summary: Flexible Date Search • flightanalysis</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Refactoring Summary: Flexible Date Search"><meta property="og:image" content="https://rempsyc.github.io/flightanalysis/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">flightanalysis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rempsyc/flightanalysis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Refactoring Summary: Flexible Date Search</h1>
      <small class="dont-index">Source: <a href="https://github.com/rempsyc/flightanalysis/blob/main/REFACTORING_SUMMARY.md" class="external-link"><code>REFACTORING_SUMMARY.md</code></a></small>
    </div>

<div id="refactoring-summary-flexible-date-search" class="section level1">

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p>This document summarizes the refactoring done to the flexible date search implementation based on user feedback (@rempsyc’s comment).</p>
</div>
<div class="section level2">
<h2 id="original-approach-before-refactoring">Original Approach (Before Refactoring)<a class="anchor" aria-label="anchor" href="#original-approach-before-refactoring"></a></h2>
<p>The original implementation had <code>fa_scrape_best_oneway()</code> handling browser initialization and scraping internally:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">fa_scrape_best_oneway</span>(routes, dates, <span class="at">pause =</span> <span class="dv">2</span>, ...) {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="co"># Initialize browser</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  browser <span class="ot">&lt;-</span> <span class="fu">initialize_chromote_browser</span>()</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  </span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="co"># Loop through each route-date combination</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="cf">for</span> (combination <span class="cf">in</span> all_combinations) {</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    <span class="co"># Create individual Scrape object</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    scrape <span class="ot">&lt;-</span> <span class="fu">Scrape</span>(origin, dest, date)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="co"># Scrape immediately</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    scrape <span class="ot">&lt;-</span> <span class="fu">scrape_data_chromote</span>(scrape, browser)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    <span class="co"># Extract cheapest</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    results[[i]] <span class="ot">&lt;-</span> cheapest_flight</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>    <span class="co"># Rate limit</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(pause)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  }</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  </span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  <span class="fu">close_browser</span>()</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Issues:</strong> - Browser managed internally - Created many individual Scrape objects - Didn’t leverage existing chain-trip functionality - Duplicate scraping logic</p>
</div>
<div class="section level2">
<h2 id="new-approach-after-refactoring">New Approach (After Refactoring)<a class="anchor" aria-label="anchor" href="#new-approach-after-refactoring"></a></h2>
<p>The refactored implementation separates concerns and leverages chain-trips:</p>
<div class="section level3">
<h3 id="id_1-helper-function-fa_create_date_range_scrape">1. Helper Function: <code>fa_create_date_range_scrape()</code>
<a class="anchor" aria-label="anchor" href="#id_1-helper-function-fa_create_date_range_scrape"></a></h3>
<p>Creates a <strong>single</strong> chain-trip Scrape object with all permutations:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">fa_create_date_range_scrape</span>(airports, dest, date_min, date_max) {</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="co"># Generate all airport × date combinations</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  combinations <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(airports, dates)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  </span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="co"># Build chain-trip args: origin1, dest1, date1, origin2, dest2, date2, ...</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  args <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="cf">for</span> (combo <span class="cf">in</span> combinations) {</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    args <span class="ot">&lt;-</span> <span class="fu">c</span>(args, <span class="fu">list</span>(combo<span class="sc">$</span>airport, dest, combo<span class="sc">$</span>date))</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  }</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  </span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  <span class="co"># Create single Scrape object</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  scrape <span class="ot">&lt;-</span> <span class="fu">do.call</span>(Scrape, args)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  <span class="fu">return</span>(scrape)  <span class="co"># No scraping yet!</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_2-main-function-fa_scrape_best_oneway">2. Main Function: <code>fa_scrape_best_oneway()</code>
<a class="anchor" aria-label="anchor" href="#id_2-main-function-fa_scrape_best_oneway"></a></h3>
<p>Now uses the helper + existing <code><a href="reference/ScrapeObjects.html">ScrapeObjects()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">fa_scrape_best_oneway</span>(routes, dates, ...) {</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="co"># Create single Scrape object with ALL queries</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  scrape <span class="ot">&lt;-</span> <span class="fu">fa_create_date_range_scrape</span>(</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="at">airports =</span> routes<span class="sc">$</span>Airport,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="at">dest =</span> routes<span class="sc">$</span>Dest[<span class="dv">1</span>],</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="at">date_min =</span> <span class="fu">min</span>(dates),</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="at">date_max =</span> <span class="fu">max</span>(dates)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  )</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  </span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="co"># Use existing ScrapeObjects() to scrape everything at once</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  scrape <span class="ot">&lt;-</span> <span class="fu">ScrapeObjects</span>(scrape, <span class="at">verbose =</span> verbose)</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  </span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="co"># Filter placeholder rows</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  scrape<span class="sc">$</span>data <span class="ot">&lt;-</span> <span class="fu">filter_placeholder_rows</span>(scrape<span class="sc">$</span>data)</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  </span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  <span class="co"># Process into desired format</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">process_scrape_results</span>(scrape<span class="sc">$</span>data, routes, keep_offers)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  </span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_3-analysis-functions-unchanged">3. Analysis Functions (Unchanged)<a class="anchor" aria-label="anchor" href="#id_3-analysis-functions-unchanged"></a></h3>
<p><code><a href="reference/fa_flex_table.html">fa_flex_table()</a></code> and <code><a href="reference/fa_best_dates.html">fa_best_dates()</a></code> remain as pure filter/analysis functions on the scraped data.</p>
</div>
</div>
<div class="section level2">
<h2 id="key-benefits">Key Benefits<a class="anchor" aria-label="anchor" href="#key-benefits"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>Reduced Browser Requests</strong>
<ul><li>Before: Browser initialized once, but many individual scrapes</li>
<li>After: Single chain-trip Scrape object, one batch scrape</li>
</ul></li>
<li>
<strong>Leverages Existing Architecture</strong>
<ul><li>Uses existing <code><a href="reference/Scrape.html">Scrape()</a></code> constructor for chain-trips</li>
<li>Uses existing <code><a href="reference/ScrapeObjects.html">ScrapeObjects()</a></code> for scraping</li>
<li>No duplicate browser management logic</li>
</ul></li>
<li>
<strong>Separation of Concerns</strong>
<ul><li>Step 1: Create Scrape object (query definition)</li>
<li>Step 2: Call ScrapeObjects() (scraping)</li>
<li>Step 3: Apply filters/analysis (data processing)</li>
</ul></li>
<li>
<strong>More Flexible</strong>
<ul><li>Users can create Scrape object separately for custom workflows</li>
<li>Can inspect/modify Scrape object before scraping</li>
<li>Can apply custom filters on raw data</li>
</ul></li>
</ol></div>
<div class="section level2">
<h2 id="example-workflows">Example Workflows<a class="anchor" aria-label="anchor" href="#example-workflows"></a></h2>
<div class="section level3">
<h3 id="workflow-1-convenience-function-one-step">Workflow 1: Convenience Function (One-Step)<a class="anchor" aria-label="anchor" href="#workflow-1-convenience-function-one-step"></a></h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rempsyc/flightanalysis" class="external-link">flightanalysis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">routes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  City <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mumbai"</span>, <span class="st">"Delhi"</span>, <span class="st">"Varanasi"</span><span class="op">)</span>,</span>
<span>  Airport <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BOM"</span>, <span class="st">"DEL"</span>, <span class="st">"VNS"</span><span class="op">)</span>,</span>
<span>  Dest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"JFK"</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2025-12-18"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2026-01-05"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Single function call handles everything</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">fa_scrape_best_oneway</span><span class="op">(</span><span class="va">routes</span>, <span class="va">dates</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyze</span></span>
<span><span class="va">summary_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fa_flex_table.html">fa_flex_table</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="va">best_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fa_best_dates.html">fa_best_dates</a></span><span class="op">(</span><span class="va">results</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="workflow-2-separated-steps-more-control">Workflow 2: Separated Steps (More Control)<a class="anchor" aria-label="anchor" href="#workflow-2-separated-steps-more-control"></a></h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rempsyc/flightanalysis" class="external-link">flightanalysis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 1: Create Scrape object (no scraping yet)</span></span>
<span><span class="va">scrape</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fa_create_date_range_scrape.html">fa_create_date_range_scrape</a></span><span class="op">(</span></span>
<span>  airports <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BOM"</span>, <span class="st">"DEL"</span>, <span class="st">"VNS"</span><span class="op">)</span>,</span>
<span>  dest <span class="op">=</span> <span class="st">"JFK"</span>,</span>
<span>  date_min <span class="op">=</span> <span class="st">"2025-12-18"</span>,</span>
<span>  date_max <span class="op">=</span> <span class="st">"2026-01-05"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect before scraping</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scrape</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total queries:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">scrape</span><span class="op">$</span><span class="va">origin</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Scrape when ready</span></span>
<span><span class="va">scrape</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ScrapeObjects.html">ScrapeObjects</a></span><span class="op">(</span><span class="va">scrape</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, headless <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Process data</span></span>
<span><span class="va">filtered_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/filter_placeholder_rows.html">filter_placeholder_rows</a></span><span class="op">(</span><span class="va">scrape</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract date from scraped data</span></span>
<span><span class="va">filtered_data</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">filtered_data</span><span class="op">$</span><span class="va">departure_datetime</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom analysis</span></span>
<span><span class="va">cheapest_per_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">price</span> <span class="op">~</span> <span class="va">Date</span>,</span>
<span>  data <span class="op">=</span> <span class="va">filtered_data</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">min</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cheapest_per_date</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or use helper functions</span></span>
<span><span class="co"># (Note: Need to format data properly for these functions)</span></span>
<span><span class="co"># summary_table &lt;- fa_flex_table(processed_results)</span></span>
<span><span class="co"># best_dates &lt;- fa_best_dates(processed_results, n = 5)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="implementation-details">Implementation Details<a class="anchor" aria-label="anchor" href="#implementation-details"></a></h2>
<div class="section level3">
<h3 id="chain-trip-creation">Chain-Trip Creation<a class="anchor" aria-label="anchor" href="#chain-trip-creation"></a></h3>
<p>The helper function generates arguments dynamically:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For airports = c("BOM", "DEL") and dates = c("2025-12-18", "2025-12-19")</span></span>
<span><span class="co"># Creates args: ["BOM", "JFK", "2025-12-18", "DEL", "JFK", "2025-12-18", </span></span>
<span><span class="co">#                "BOM", "JFK", "2025-12-19", "DEL", "JFK", "2025-12-19"]</span></span>
<span><span class="co"># Which creates a chain-trip with 4 segments</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-processing">Data Processing<a class="anchor" aria-label="anchor" href="#data-processing"></a></h3>
<p>The <code>process_scrape_results()</code> function: 1. Extracts dates from <code>departure_datetime</code> 2. Maps airport codes to city names from routes 3. Groups by airport-date combinations 4. Extracts cheapest price (or stores all offers) 5. Formats into expected structure</p>
</div>
<div class="section level3">
<h3 id="placeholder-filtering">Placeholder Filtering<a class="anchor" aria-label="anchor" href="#placeholder-filtering"></a></h3>
<p>Applied after scraping to remove: - “Price graph” entries - “Price unavailable” entries - Empty airline names - Rows with NA prices</p>
</div>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h2>
<p>Added tests for the new helper function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"fa_create_date_range_scrape creates valid Scrape object"</span>, <span class="op">{</span></span>
<span>  <span class="va">scrape</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fa_create_date_range_scrape.html">fa_create_date_range_scrape</a></span><span class="op">(</span></span>
<span>    airports <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BOM"</span>, <span class="st">"DEL"</span><span class="op">)</span>,</span>
<span>    dest <span class="op">=</span> <span class="st">"JFK"</span>,</span>
<span>    date_min <span class="op">=</span> <span class="st">"2025-12-18"</span>,</span>
<span>    date_max <span class="op">=</span> <span class="st">"2025-12-20"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">expect_s3_class</span><span class="op">(</span><span class="va">scrape</span>, <span class="st">"Scrape"</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">scrape</span><span class="op">$</span><span class="va">type</span>, <span class="st">"chain-trip"</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">scrape</span><span class="op">$</span><span class="va">origin</span><span class="op">)</span>, <span class="fl">6</span><span class="op">)</span>  <span class="co"># 2 airports × 3 dates</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="migration-guide">Migration Guide<a class="anchor" aria-label="anchor" href="#migration-guide"></a></h2>
<p>For users of the original implementation:</p>
<p><strong>Before:</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">fa_scrape_best_oneway</span><span class="op">(</span><span class="va">routes</span>, <span class="va">dates</span>, pause <span class="op">=</span> <span class="fl">3</span>, currency_format <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>After:</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pause and currency_format parameters removed</span></span>
<span><span class="co"># pause is no longer needed (single batch request)</span></span>
<span><span class="co"># currency formatting done by fa_flex_table()</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">fa_scrape_best_oneway</span><span class="op">(</span><span class="va">routes</span>, <span class="va">dates</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply currency formatting in table</span></span>
<span><span class="va">summary_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fa_flex_table.html">fa_flex_table</a></span><span class="op">(</span><span class="va">results</span>, currency_symbol <span class="op">=</span> <span class="st">"$"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="files-modified">Files Modified<a class="anchor" aria-label="anchor" href="#files-modified"></a></h2>
<ol style="list-style-type: decimal"><li>
<p><strong>R/flex_search.R</strong> - Complete rewrite</p>
<ul><li>Added <code><a href="reference/fa_create_date_range_scrape.html">fa_create_date_range_scrape()</a></code> function</li>
<li>Refactored <code>fa_scrape_best_oneway()</code> to use helper + ScrapeObjects()</li>
<li>Added <code>process_scrape_results()</code> internal helper</li>
<li>Removed direct browser management code</li>
</ul></li>
<li><p><strong>NAMESPACE</strong> - Added export for <code>fa_create_date_range_scrape</code></p></li>
<li><p><strong>README.md</strong> - Updated examples to show both workflows</p></li>
<li><p><strong>NEWS.md</strong> - Updated feature descriptions to reflect new architecture</p></li>
<li><p><strong>examples/flexible_date_search.R</strong> - Added examples for separated workflow</p></li>
<li><p><strong>tests/testthat/test-flex_search.R</strong> - Added tests for helper function</p></li>
</ol></div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a></h2>
<p>This refactoring aligns the implementation with the existing package architecture, reduces code duplication, and provides users with more flexibility while maintaining a simple convenience function for common use cases.</p>
<p>The key insight from @rempsyc’s feedback was to recognize that the existing chain-trip functionality already solves the “multiple queries” problem - we just needed a helper to make it easier to create chain-trip Scrape objects from flexible parameters.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kaya Celebi, Rémi Thériault.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

