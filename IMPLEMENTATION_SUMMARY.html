<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Implementation Summary: Flexible Date Search • flightanalysis</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Implementation Summary: Flexible Date Search"><meta property="og:image" content="https://rempsyc.github.io/flightanalysis/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">flightanalysis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rempsyc/flightanalysis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Implementation Summary: Flexible Date Search</h1>
      <small class="dont-index">Source: <a href="https://github.com/rempsyc/flightanalysis/blob/main/IMPLEMENTATION_SUMMARY.md" class="external-link"><code>IMPLEMENTATION_SUMMARY.md</code></a></small>
    </div>

<div id="implementation-summary-flexible-date-search" class="section level1">

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p>This document summarizes the implementation of flexible date search functionality for the flightanalysis R package, addressing GitHub issue requesting the ability to search over flexible date ranges and multiple airports.</p>
</div>
<div class="section level2">
<h2 id="problem-statement">Problem Statement<a class="anchor" aria-label="anchor" href="#problem-statement"></a></h2>
<p>Users needed the ability to: 1. Search flights across flexible date ranges (e.g., “Dec 18 – Jan 5”) 2. Search across multiple airports/cities 3. Store all scraped offers per date, or extract only the cheapest 4. Output wide summary tables (City × Date with Average Price) 5. Identify best travel dates automatically 6. Filter out placeholder rows like “Price graph” 7. Support currency formatting 8. Include polite rate-limiting</p>
</div>
<div class="section level2">
<h2 id="solution">Solution<a class="anchor" aria-label="anchor" href="#solution"></a></h2>
<p><strong>Note:</strong> The implementation was refactored based on user feedback. See <code>REFACTORING_SUMMARY.md</code> for details on the architectural changes.</p>
<p>Four new exported functions were added to provide an intuitive workflow:</p>
<div class="section level3">
<h3 id="id_1-fa_create_date_range_scrapeairports-dest-date_min-date_max">1. <code>fa_create_date_range_scrape(airports, dest, date_min, date_max)</code>
<a class="anchor" aria-label="anchor" href="#id_1-fa_create_date_range_scrapeairports-dest-date_min-date_max"></a></h3>
<p><strong>Purpose</strong>: Helper function to create chain-trip Scrape object with flexible parameters</p>
<p><strong>Parameters</strong>: - <code>airports</code>: Character vector of 3-letter airport codes - <code>dest</code>: Character, single 3-letter destination code - <code>date_min</code>: Start date (Date or character in “YYYY-MM-DD”) - <code>date_max</code>: End date (Date or character in “YYYY-MM-DD”)</p>
<p><strong>Features</strong>: - Generates all airport × date combinations - Creates chain-trip Scrape object WITHOUT scraping - Returns Scrape object ready to pass to <code><a href="reference/ScrapeObjects.html">ScrapeObjects()</a></code> - Leverages existing chain-trip functionality</p>
<p><strong>Returns</strong>: Scrape object of type “chain-trip”</p>
</div>
<div class="section level3">
<h3 id="id_2-fa_scrape_best_onewayroutes-dates-">2. <code>fa_scrape_best_oneway(routes, dates, ...)</code>
<a class="anchor" aria-label="anchor" href="#id_2-fa_scrape_best_onewayroutes-dates-"></a></h3>
<p><strong>Purpose</strong>: Main scraping function for multiple routes and dates</p>
<p><strong>Parameters</strong>: - <code>routes</code>: Data frame with columns City, Airport, Dest (+ optional Comment) - <code>dates</code>: Vector of dates (Date objects or character strings) - <code>keep_offers</code>: Logical, store all offers or only cheapest (default: FALSE) - <code>headless</code>: Run browser in headless mode (default: TRUE) - <code>verbose</code>: Show progress information (default: TRUE)</p>
<p><strong>Features</strong>: - Uses <code><a href="reference/fa_create_date_range_scrape.html">fa_create_date_range_scrape()</a></code> to create batch Scrape object - Calls <code><a href="reference/ScrapeObjects.html">ScrapeObjects()</a></code> to scrape all queries in one browser session - Filters placeholder rows automatically - Processes results into user-friendly format - Comprehensive error messages</p>
<p><strong>Returns</strong>: Data frame with columns: City, Airport, Dest, Date, Price, and optionally Comment and Offers</p>
</div>
<div class="section level3">
<h3 id="id_3-fa_flex_tableresults-">3. <code>fa_flex_table(results, ...)</code>
<a class="anchor" aria-label="anchor" href="#id_3-fa_flex_tableresults-"></a></h3>
<p><strong>Purpose</strong>: Create wide summary table for easy comparison</p>
<p><strong>Parameters</strong>: - <code>results</code>: Data frame from fa_scrape_best_oneway() - <code>include_comment</code>: Include comment column (default: TRUE) - <code>currency_symbol</code>: Symbol for formatting (default: “$”) - <code>round_prices</code>: Round to integers (default: TRUE)</p>
<p><strong>Features</strong>: - Reshapes data to City × Date format - Calculates average price per route - Sorts date columns chronologically - Formats prices with currency symbols (using scales package) - Handles missing values gracefully</p>
<p><strong>Returns</strong>: Wide data frame with City, Airport, [Comment], date columns, and Average_Price</p>
</div>
<div class="section level3">
<h3 id="id_4-fa_best_datesresults-n-by">4. <code>fa_best_dates(results, n, by)</code>
<a class="anchor" aria-label="anchor" href="#id_4-fa_best_datesresults-n-by"></a></h3>
<p><strong>Purpose</strong>: Identify cheapest travel dates</p>
<p><strong>Parameters</strong>: - <code>results</code>: Data frame from fa_scrape_best_oneway() - <code>n</code>: Number of best dates to return (default: 10) - <code>by</code>: Aggregation method: “mean”, “median”, or “min” (default: “mean”)</p>
<p><strong>Features</strong>: - Aggregates prices by date - Supports multiple aggregation methods - Includes route count per date - Returns sorted results (cheapest first)</p>
<p><strong>Returns</strong>: Data frame with Date, Price (aggregated), and N_Routes columns</p>
</div>
</div>
<div class="section level2">
<h2 id="internal-helper-functions">Internal Helper Functions<a class="anchor" aria-label="anchor" href="#internal-helper-functions"></a></h2>
<div class="section level3">
<h3 id="filter_placeholder_rowsdata"><code>filter_placeholder_rows(data)</code><a class="anchor" aria-label="anchor" href="#filter_placeholder_rowsdata"></a></h3>
<p>Removes placeholder entries from scraped data: - “Price graph” - “Price unavailable” - Empty/whitespace entries - Rows with NA prices</p>
<p>Case-insensitive matching for robustness.</p>
</div>
<div class="section level3">
<h3 id="process_scrape_resultsscrape_data-routes-keep_offers-verbose"><code>process_scrape_results(scrape_data, routes, keep_offers, verbose)</code><a class="anchor" aria-label="anchor" href="#process_scrape_resultsscrape_data-routes-keep_offers-verbose"></a></h3>
<p>Processes raw scraped data into user-friendly format: - Extracts dates from departure_datetime - Maps airport codes to city names - Groups by airport-date combinations - Extracts cheapest price or stores all offers - Formats into expected data structure</p>
</div>
</div>
<div class="section level2">
<h2 id="file-changes">File Changes<a class="anchor" aria-label="anchor" href="#file-changes"></a></h2>
<div class="section level3">
<h3 id="new-files">New Files<a class="anchor" aria-label="anchor" href="#new-files"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>R/flex_search.R</strong> (470 lines)
<ul><li>All new functions with comprehensive roxygen2 documentation</li>
<li>Internal helper functions for filtering and processing</li>
<li>Refactored to use chain-trip approach</li>
</ul></li>
<li>
<strong>tests/testthat/test-flex_search.R</strong> (165 lines)
<ul><li>9 test cases covering:
<ul><li>Placeholder filtering</li>
<li>Wide table creation</li>
<li>Best date identification</li>
<li>Different aggregation methods</li>
<li>Helper function validation</li>
<li>Input validation</li>
<li>Edge cases</li>
</ul></li>
</ul></li>
<li>
<strong>examples/flexible_date_search.R</strong> (101 lines)
<ul><li>Basic usage examples</li>
<li>Mock data demonstrations</li>
<li>Usage tips</li>
</ul></li>
<li>
<strong>examples/issue_example.R</strong> (143 lines)
<ul><li>Exact use case from GitHub issue</li>
<li>Comprehensive workflow demonstration</li>
<li>Real-world tips</li>
</ul></li>
<li>
<strong>examples/workflow_diagram.md</strong> (115 lines)
<ul><li>Visual workflow diagrams</li>
<li>Data structure flow</li>
<li>Step-by-step examples</li>
</ul></li>
<li>
<strong>NEWS.md</strong> (38 lines)
<ul><li>Version history</li>
<li>Feature documentation</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="modified-files">Modified Files<a class="anchor" aria-label="anchor" href="#modified-files"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>DESCRIPTION</strong>
<ul><li>Added <code>scales</code> and <code>tibble</code> to Suggests</li>
</ul></li>
<li>
<strong>NAMESPACE</strong>
<ul><li>Exported 4 new functions (added fa_create_date_range_scrape)</li>
</ul></li>
<li>
<strong>R/flightanalysis-package.R</strong>
<ul><li>Updated package documentation</li>
<li>Added new functions to main functions list</li>
</ul></li>
<li>
<strong>README.md</strong>
<ul><li>Added “Flexible Date Search (NEW!)” section</li>
<li>Updated features list</li>
<li>Added examples for both convenience and separated workflows</li>
<li>Updated release notes</li>
</ul></li>
<li>
<strong>REFACTORING_SUMMARY.md</strong> (new file)
<ul><li>Detailed explanation of architectural changes</li>
<li>Comparison of before/after approaches</li>
<li>Migration guide for users</li>
</ul></li>
</ol></div>
</div>
<div class="section level2">
<h2 id="design-decisions">Design Decisions<a class="anchor" aria-label="anchor" href="#design-decisions"></a></h2>
<div class="section level3">
<h3 id="why-these-function-names">Why These Function Names?<a class="anchor" aria-label="anchor" href="#why-these-function-names"></a></h3>
<ul><li>
<code><a href="reference/fa_create_date_range_scrape.html">fa_create_date_range_scrape()</a></code>: Clear purpose - creates Scrape object for date range</li>
<li>
<code>fa_scrape_best_oneway()</code>: Clear that it’s flight analysis (fa_), scrapes data, finds best prices, one-way trips</li>
<li>
<code><a href="reference/fa_flex_table.html">fa_flex_table()</a></code>: Indicates flexible date table output</li>
<li>
<code><a href="reference/fa_best_dates.html">fa_best_dates()</a></code>: Simple, self-explanatory</li>
</ul></div>
<div class="section level3">
<h3 id="why-not-use-tidyrdplyr">Why Not Use tidyr/dplyr?<a class="anchor" aria-label="anchor" href="#why-not-use-tidyrdplyr"></a></h3>
<ul><li>Minimal dependencies (base R stats::reshape, stats::aggregate)</li>
<li>Package can work without tidyverse</li>
<li>More portable and lighter weight</li>
</ul></div>
<div class="section level3">
<h3 id="why-use-chain-trip-approach">Why Use Chain-Trip Approach?<a class="anchor" aria-label="anchor" href="#why-use-chain-trip-approach"></a></h3>
<ul><li>Leverages existing tested functionality (no duplicate code)</li>
<li>Single browser session for all queries (more efficient)</li>
<li>Separates query definition from scraping (better design)</li>
<li>Allows users to inspect/modify Scrape object before scraping</li>
</ul></div>
<div class="section level3">
<h3 id="why-filter-placeholders-automatically">Why Filter Placeholders Automatically?<a class="anchor" aria-label="anchor" href="#why-filter-placeholders-automatically"></a></h3>
<ul><li>Users always want real flight data</li>
<li>Placeholder rows have no analytical value</li>
<li>Simplifies downstream analysis</li>
</ul></div>
<div class="section level3">
<h3 id="why-support-multiple-aggregation-methods">Why Support Multiple Aggregation Methods?<a class="anchor" aria-label="anchor" href="#why-support-multiple-aggregation-methods"></a></h3>
<ul><li>“mean”: Best for finding consistently cheap dates</li>
<li>“median”: Robust to outliers</li>
<li>“min”: Best for finding absolute cheapest options</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="usage-example">Usage Example<a class="anchor" aria-label="anchor" href="#usage-example"></a></h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rempsyc/flightanalysis" class="external-link">flightanalysis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define routes</span></span>
<span><span class="va">routes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  City <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mumbai"</span>, <span class="st">"Delhi"</span>, <span class="st">"Varanasi"</span><span class="op">)</span>,</span>
<span>  Airport <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BOM"</span>, <span class="st">"DEL"</span>, <span class="st">"VNS"</span><span class="op">)</span>,</span>
<span>  Dest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"JFK"</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  Comment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original"</span>, <span class="st">""</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define dates</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2025-12-18"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2026-01-05"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Scrape data (3 routes × 19 dates = 57 queries)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">fa_scrape_best_oneway</span><span class="op">(</span><span class="va">routes</span>, <span class="va">dates</span>, pause <span class="op">=</span> <span class="fl">3</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create summary table</span></span>
<span><span class="va">summary_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fa_flex_table.html">fa_flex_table</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary_table</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find best dates</span></span>
<span><span class="va">best_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fa_best_dates.html">fa_best_dates</a></span><span class="op">(</span><span class="va">results</span>, n <span class="op">=</span> <span class="fl">5</span>, by <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">best_dates</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="testing-strategy">Testing Strategy<a class="anchor" aria-label="anchor" href="#testing-strategy"></a></h2>
<p>Tests cover: 1. <strong>Core functionality</strong>: Filtering, table creation, date aggregation 2. <strong>Edge cases</strong>: Empty data, missing columns, single route 3. <strong>Input validation</strong>: Error messages for invalid inputs 4. <strong>Different scenarios</strong>: Multiple aggregation methods, with/without comments</p>
<p>All tests use mock data (no live scraping) for reliability and speed.</p>
</div>
<div class="section level2">
<h2 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a></h2>
<ul><li>Browser initialized once (not per query)</li>
<li>Pre-allocated results list (no growing vectors)</li>
<li>Built-in rate limiting to avoid overload</li>
<li>Efficient filtering using vectorized operations</li>
</ul></div>
<div class="section level2">
<h2 id="future-enhancements">Future Enhancements<a class="anchor" aria-label="anchor" href="#future-enhancements"></a></h2>
<p>Potential improvements for future versions: 1. Progress bars using <code>progress</code> package 2. Caching support (avoid re-scraping) 3. Parallel scraping (with appropriate rate limiting) 4. Support for round-trip searches 5. Export to CSV/Excel with formatting 6. Interactive plots using plotly</p>
</div>
<div class="section level2">
<h2 id="documentation-quality">Documentation Quality<a class="anchor" aria-label="anchor" href="#documentation-quality"></a></h2>
<p>All functions include: - Clear descriptions - Parameter documentation with types and defaults - Return value documentation - Examples with  - @export tags for NAMESPACE - @keywords internal for helpers</p>
</div>
<div class="section level2">
<h2 id="compliance-with-issue-requirements">Compliance with Issue Requirements<a class="anchor" aria-label="anchor" href="#compliance-with-issue-requirements"></a></h2>
<p>✅ Search over flexible date ranges<br>
✅ Search over multiple airports<br>
✅ Store all scraped offers (keep_offers option)<br>
✅ Extract cheapest one per day (default behavior)<br>
✅ Wide summary table (City × Date + Average Price)<br>
✅ Helper to extract top N dates<br>
✅ Remove placeholder rows (“Price graph”, etc.)<br>
✅ Currency formatting (scales::dollar)<br>
✅ Rate-limiting (pause argument)<br>
✅ Progress reporting (verbose option)</p>
</div>
<div class="section level2">
<h2 id="code-quality">Code Quality<a class="anchor" aria-label="anchor" href="#code-quality"></a></h2>
<ul><li>Follows R package conventions</li>
<li>Comprehensive error handling</li>
<li>Clear variable names</li>
<li>Modular design (separate concerns)</li>
<li>DRY principle (no code duplication)</li>
<li>Defensive programming (input validation)</li>
</ul></div>
<div class="section level2">
<h2 id="backward-compatibility">Backward Compatibility<a class="anchor" aria-label="anchor" href="#backward-compatibility"></a></h2>
<ul><li>No changes to existing functions</li>
<li>Only additions (new file, new exports)</li>
<li>Existing code continues to work unchanged</li>
</ul></div>
<div class="section level2">
<h2 id="total-changes">Total Changes<a class="anchor" aria-label="anchor" href="#total-changes"></a></h2>
<ul><li>
<strong>Lines of code added</strong>: ~1,096</li>
<li>
<strong>New functions</strong>: 3 exported, 1 internal</li>
<li>
<strong>Test coverage</strong>: 7 test cases</li>
<li>
<strong>Documentation</strong>: Comprehensive roxygen2 + examples</li>
<li>
<strong>Files created</strong>: 6</li>
<li>
<strong>Files modified</strong>: 4</li>
</ul></div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a></h2>
<p>This implementation provides a complete solution for flexible date search in the flightanalysis package. Users can now easily search across multiple airports and dates, view results in intuitive summary tables, and quickly identify the best travel dates - all with minimal code and maximum flexibility.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kaya Celebi, Rémi Thériault.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

